<button (click)="openModal()"
  class="px-6 py-3 flex items-center gap-2 rounded-lg border-2 border-black text-black font-semibold hover:bg-black hover:text-white transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-xl relative">
  <i class="pi pi-sliders-v"></i>
  <span>Filtrar & Ordenar</span>
  @if (hasActiveFilters()) {
  <span
    class="absolute -top-2 -right-2 bg-cyan-400 text-black text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center animate-pulse">
    {{ getFilterCount() }}
  </span>
  }
</button>
<p-dialog [(visible)]="visible" [modal]="true" [draggable]="false" [closable]="false" [showHeader]="false"
  (onHide)="closeModal()" styleClass="filter-modal" [style]="{ 
    width: '100%', 
    maxWidth: '600px',
    height: 'auto',
    maxHeight: '90vh',
    padding: '0',
    borderRadius: '16px',
    display: 'flex',
    flexDirection: 'column',
    overflow: 'hidden'
  }" [contentStyleClass]="'p-0 bg-white rounded-2xl overflow-hidden shadow-2xl'">
  <div class="w-full flex items-center justify-between px-6 py-5 bg-white border-b-2 border-gray-200">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-black rounded-full flex items-center justify-center shadow-lg">
        <i class="pi pi-sliders-v text-white"></i>
      </div>
      <div>
        <h2 class="text-lg font-bold text-black">Filtrar Produtos</h2>
        @if (hasActiveFilters()) {
        <p class="text-xs text-cyan-400 font-medium">{{ getFilterCount() }} filtro(s) ativo(s)</p>
        }
      </div>
    </div>
    <button 
      (click)="closeModal()"
      class="p-2 hover:bg-gray-100 rounded-full transition-all duration-300 flex-shrink-0 transform hover:rotate-90">
      <i class="pi pi-times text-black text-xl"></i>
    </button>
  </div>
  <div class="px-6 py-4 overflow-y-auto flex-1 scrollbar scrollbar-thin scrollbar-thumb-gray-800 scrollbar-track-gray-100"
    style="max-height: calc(90vh - 180px)">
    <div class="mb-6 filter-section">
      <button (click)="toggleFilterSection('category')"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl flex justify-between items-center hover:bg-gray-50 hover:border-black transition-all duration-300 shadow-sm hover:shadow-md">
        <div class="flex items-center gap-2">
          <i class="pi pi-tag text-black"></i>
          <span class="font-semibold text-black">Categoria</span>
          @if (tempFilters.category) {
          <span class="text-xs bg-cyan-400 text-black px-2 py-1 rounded-full font-bold">1</span>
          }
        </div>
        <i class="pi text-black transition-transform duration-300"
          [class]="expandedSections.category ? 'pi-chevron-up rotate-180' : 'pi-chevron-down'"></i>
      </button>

      @if (expandedSections.category) {
      <div class="mt-4 pl-4 border-l-4 border-cyan-400 space-y-2 animate-slideDown">
        @for (cat of categories; track $index) {
        <label
          class="flex items-center gap-3 py-2.5 px-3 cursor-pointer rounded-lg hover:bg-gray-50 transition-all duration-200 group">
          <input type="radio" [value]="cat.value" [(ngModel)]="tempFilters.category"
            class="w-5 h-5 cursor-pointer accent-black" />
          <span class="text-gray-700 group-hover:text-black font-medium">{{ cat.label }}</span>
        </label>
        }
      </div>
      }
    </div>
    <div class="mb-6 filter-section">
      <button (click)="toggleFilterSection('price')"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl flex justify-between items-center hover:bg-gray-50 hover:border-black transition-all duration-300 shadow-sm hover:shadow-md">
        <div class="flex items-center gap-2">
          <i class="pi pi-dollar text-black"></i>
          <span class="font-semibold text-black">Faixa de Preço</span>
          @if (priceRange[0] > minPrice || priceRange[1] < maxPrice) { <span
            class="text-xs bg-cyan-400 text-black px-2 py-1 rounded-full font-bold">1</span>
            }
        </div>
        <i class="pi text-black transition-transform duration-300"
          [class]="expandedSections.price ? 'pi-chevron-up rotate-180' : 'pi-chevron-down'"></i>
      </button>

      @if (expandedSections.price) {
      <div class="mt-4 pl-4 border-l-4 border-cyan-400 space-y-5 animate-slideDown">
        <div class="grid grid-cols-2 gap-4">
          <div class="flex flex-col">
            <label class="text-sm font-semibold text-black mb-2 flex items-center gap-1">
              <i class="pi pi-arrow-down text-xs text-cyan-400"></i>
              Mínimo
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium">R$</span>
              <input type="number" [(ngModel)]="priceRange[0]" [max]="priceRange[1]" [min]="minPrice"
                class="w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-sm font-medium focus:outline-none focus:border-black focus:ring-2 focus:ring-cyan-400 transition-all">
            </div>
          </div>
          <div class="flex flex-col">
            <label class="text-sm font-semibold text-black mb-2 flex items-center gap-1">
              <i class="pi pi-arrow-up text-xs text-cyan-400"></i>
              Máximo
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium">R$</span>
              <input type="number" [(ngModel)]="priceRange[1]" [max]="maxPrice" [min]="priceRange[0]"
                class="w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-sm font-medium focus:outline-none focus:border-black focus:ring-2 focus:ring-cyan-400 transition-all">
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    <div class="mb-6 filter-section">
      <button (click)="toggleFilterSection('size')"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl flex justify-between items-center hover:bg-gray-50 hover:border-black transition-all duration-300 shadow-sm hover:shadow-md">
        <div class="flex items-center gap-2">
          <i class="pi pi-box text-black"></i>
          <span class="font-semibold text-black">Tamanho</span>
          @if (selectedSizes.length > 0) {
          <span class="text-xs bg-cyan-400 text-black px-2 py-1 rounded-full font-bold">{{ selectedSizes.length }}</span>
          }
        </div>
        <i class="pi text-black transition-transform duration-300"
          [class]="expandedSections.size ? 'pi-chevron-up rotate-180' : 'pi-chevron-down'"></i>
      </button>

      @if (expandedSections.size) {
      <div class="mt-4 pl-4 border-l-4 border-cyan-400 animate-slideDown">
        <div class="grid grid-cols-3 gap-3">
          @for (size of sizes; track $index) {
          <button (click)="toggleSize(size.value)" [class]="'px-4 py-3 rounded-xl border-2 font-bold transition-all duration-300 transform hover:scale-105 shadow-sm ' + 
              (isSizeSelected(size.value) 
                ? 'border-black bg-black text-white shadow-lg scale-105' 
                : 'border-gray-300 text-gray-700 hover:border-black hover:bg-gray-50')">
            {{ size.label }}
          </button>
          }
        </div>
      </div>
      }
    </div>
    <div class="mb-6 filter-section">
      <button (click)="toggleFilterSection('color')"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl flex justify-between items-center hover:bg-gray-50 hover:border-black transition-all duration-300 shadow-sm hover:shadow-md">
        <div class="flex items-center gap-2">
          <i class="pi pi-palette text-black"></i>
          <span class="font-semibold text-black">Cor</span>
          @if (selectedColors.length > 0) {
          <span class="text-xs bg-cyan-400 text-black px-2 py-1 rounded-full font-bold">{{ selectedColors.length }}</span>
          }
        </div>
        <i class="pi text-black transition-transform duration-300"
          [class]="expandedSections.color ? 'pi-chevron-up rotate-180' : 'pi-chevron-down'"></i>
      </button>

      @if (expandedSections.color) {
      <div class="mt-4 pl-4 border-l-4 border-cyan-400 animate-slideDown">
        <div class="grid grid-cols-2 gap-3">
          @for (color of colors; track $index) {
          <button (click)="toggleColor(color.value)" [class]="'flex items-center gap-3 px-4 py-3 rounded-xl border-2 transition-all duration-300 transform hover:scale-105 shadow-sm ' + 
              (isColorSelectedByValue(color.value) 
                ? 'border-black bg-gray-50 shadow-md scale-105' 
                : 'border-gray-300 hover:border-black hover:bg-gray-50')">
            <div class="relative">
              <div class="w-6 h-6 rounded-full shadow-md border-2 border-white ring-2 ring-gray-300"
                [style]="{'background-color': color.value}"></div>
              @if (isColorSelectedByValue(color.value)) {
              <i class="pi pi-check absolute -top-1 -right-1 text-xs text-white bg-black rounded-full p-0.5"></i>
              }
            </div>
            <span class="text-sm font-medium text-gray-700">{{ color.label }}</span>
          </button>
          }
        </div>
      </div>
      }
    </div>
    <div class="mb-6 filter-section">
      <button (click)="toggleFilterSection('sort')"
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl flex justify-between items-center hover:bg-gray-50 hover:border-black transition-all duration-300 shadow-sm hover:shadow-md">
        <div class="flex items-center gap-2">
          <i class="pi pi-sort-alt text-black"></i>
          <span class="font-semibold text-black">Ordenar Por</span>
          @if (tempFilters.sortBy) {
          <span class="text-xs bg-cyan-400 text-black px-2 py-1 rounded-full font-bold">1</span>
          }
        </div>
        <i class="pi text-black transition-transform duration-300"
          [class]="expandedSections.sort ? 'pi-chevron-up rotate-180' : 'pi-chevron-down'"></i>
      </button>

      @if (expandedSections.sort) {
      <div class="mt-4 pl-4 border-l-4 border-cyan-400 space-y-2 animate-slideDown">
        @for (option of sortOptions; track $index) {
        <label
          class="flex items-center gap-3 py-3 px-4 cursor-pointer rounded-xl hover:bg-gray-50 transition-all duration-200 group border-2 border-transparent hover:border-black">
          <input type="radio" [value]="option.value" [(ngModel)]="tempFilters.sortBy"
            class="w-5 h-5 cursor-pointer accent-black" />
          <div
            class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center group-hover:bg-black transition-all">
            <i
              [class]="'pi text-black group-hover:text-white transition-colors ' + getIconForSort(option.value)"></i>
          </div>
          <span class="text-gray-700 font-medium group-hover:text-black">{{ option.label }}</span>
        </label>
        }
      </div>
      }
    </div>
  </div>
  <div class="px-6 py-4 border-t-2 border-gray-200 bg-white flex gap-4 sticky bottom-0">
    <button (click)="resetFilters()"
      class="flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl font-bold text-black hover:bg-gray-100 hover:border-black transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-lg flex items-center justify-center gap-2">
      <i class="pi pi-refresh"></i>
      <span>Limpar Tudo</span>
    </button>
    <button (click)="applyFilters()"
      class="flex-1 px-6 py-4 bg-black text-white rounded-xl font-bold hover:bg-gray-800 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
      <i class="pi pi-check"></i>
      <span>Aplicar Filtros</span>
      @if (hasActiveFilters()) {
      <span class="bg-cyan-400 text-black text-xs font-bold px-2 py-1 rounded-full">{{ getFilterCount() }}</span>
      }
    </button>
  </div>
</p-dialog>